/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Injectable } from '@angular/core';
import { Router } from '@angular/router';
import { BehaviorSubject } from 'rxjs';
import { map, tap } from 'rxjs/operators';
import { getBase64DecodeUrlSafe, getBase64EncodeUrlSafe } from '../../shared/helper/base64.helper';
import { SECURITY_CONFIG } from '../domain/security-config';
import { LoginService } from './login.service';
import { RedirectorService } from './redirector.service';
/**
 * @record
 */
function HashParams() { }
/** @type {?} */
export var TOKEN_KEY = 'URS_TOKEN';
/** @type {?} */
export var ID_TOKEN_KEY = 'URS_ID_TOKEN';
/**
 * @record
 */
export function IdpIdentityToken() { }
if (false) {
    /** @type {?} */
    IdpIdentityToken.prototype.token;
    /** @type {?} */
    IdpIdentityToken.prototype.state;
    /** @type {?} */
    IdpIdentityToken.prototype.app;
}
var AuthenticationService = /** @class */ (function () {
    function AuthenticationService(loginService, router, redirectorService, securityConfig) {
        this.loginService = loginService;
        this.router = router;
        this.redirectorService = redirectorService;
        this.isLoggedIn = false;
        this.loginEvents = new BehaviorSubject('loggedout');
        this.initTokenFromStorage();
        this.securityConfig = securityConfig;
    }
    Object.defineProperty(AuthenticationService.prototype, "token", {
        get: /**
         * @return {?}
         */
        function () {
            return this._token || '';
        },
        set: /**
         * @param {?} token
         * @return {?}
         */
        function (token) {
            this._token = token;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} identityToken
     * @return {?}
     */
    AuthenticationService.prototype.login = /**
     * @param {?} identityToken
     * @return {?}
     */
    function (identityToken) {
        var _this = this;
        return this.loginService.login(identityToken)
            .pipe(tap((/**
         * @param {?} token
         * @return {?}
         */
        function (token) {
            _this.initLogin(token, identityToken);
            _this.loginEvents.next('loggedin');
        }), (/**
         * @return {?}
         */
        function () {
            _this.removeLoginInformation();
            _this.router.navigateByUrl('/login-error');
        })), map((/**
         * @return {?}
         */
        function () {
            return identityToken;
        })));
    };
    /**
     * @return {?}
     */
    AuthenticationService.prototype.logout = /**
     * @return {?}
     */
    function () {
        // Check for ID token
        /** @type {?} */
        var idToken = localStorage.getItem(ID_TOKEN_KEY);
        this.removeLoginInformation();
        if (idToken) {
            this.redirectorService.redirectToUrl(this.buildIdpLogoutUrl(idToken));
        }
        else {
            this.router.navigateByUrl('/');
        }
    };
    /**
     * @return {?}
     */
    AuthenticationService.prototype.getAuthTokenHeaderString = /**
     * @return {?}
     */
    function () {
        return 'Bearer ' + this.token;
    };
    /**
     * @return {?}
     */
    AuthenticationService.prototype.initTokenFromStorage = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var storedToken = localStorage.getItem(TOKEN_KEY);
        if (storedToken == null) {
            return;
        }
        try {
            /** @type {?} */
            var parts = storedToken.split('.');
            /** @type {?} */
            var payload = JSON.parse(atob(parts[1]));
            /** @type {?} */
            var until = new Date(payload.exp * 1000);
            /** @type {?} */
            var now = new Date();
            if (now < until) {
                this.token = storedToken;
                this.isLoggedIn = true;
                this.loginEvents.next('loggedin');
            }
        }
        catch (ex) {
            this.removeLoginInformation();
        }
    };
    /**
     * @param {?} url
     * @return {?}
     */
    AuthenticationService.prototype.loginFromUrlToken = /**
     * @param {?} url
     * @return {?}
     */
    function (url) {
        /** @type {?} */
        var identityToken = this.extractTokenFromUrl(url);
        return this.login(identityToken);
    };
    /**
     * @return {?}
     */
    AuthenticationService.prototype.getPayload = /**
     * @return {?}
     */
    function () {
        if (this.isLoggedIn) {
            /** @type {?} */
            var token = this.token;
            /** @type {?} */
            var parts = token.split('.');
            if (parts.length >= 2) {
                return JSON.parse(atob(parts[1]));
            }
        }
        return { roles: [], username: '' };
    };
    /**
     * @return {?}
     */
    AuthenticationService.prototype.loginWithRedirectUrl = /**
     * @return {?}
     */
    function () {
        this.redirectToIdpLogin(this.securityConfig.login_redirect_url);
    };
    /**
     * @param {?} targetUrl
     * @return {?}
     */
    AuthenticationService.prototype.redirectToIdpLogin = /**
     * @param {?} targetUrl
     * @return {?}
     */
    function (targetUrl) {
        this.redirectorService.redirectToUrl(this.buildIdpLoginUrl(targetUrl));
    };
    /**
     * @private
     * @param {?} token
     * @param {?} identityToken
     * @return {?}
     */
    AuthenticationService.prototype.initLogin = /**
     * @private
     * @param {?} token
     * @param {?} identityToken
     * @return {?}
     */
    function (token, identityToken) {
        this.token = token;
        this.isLoggedIn = true;
        localStorage.setItem(TOKEN_KEY, token);
        localStorage.setItem(ID_TOKEN_KEY, identityToken.token);
    };
    /**
     * @private
     * @return {?}
     */
    AuthenticationService.prototype.removeLoginInformation = /**
     * @private
     * @return {?}
     */
    function () {
        this.token = undefined;
        this.isLoggedIn = false;
        localStorage.removeItem(TOKEN_KEY);
        localStorage.removeItem(ID_TOKEN_KEY);
        this.loginEvents.next('loggedout');
    };
    /**
     * @private
     * @param {?} state
     * @return {?}
     */
    AuthenticationService.prototype.buildIdpLoginUrl = /**
     * @private
     * @param {?} state
     * @return {?}
     */
    function (state) {
        return this.securityConfig.idp_base_url + 'auth'
            + '?response_type=id_token'
            + '&scope=openid'
            + '&nonce=' + this.generateNonce()
            + '&client_id=' + encodeURIComponent(this.securityConfig.client_id)
            + '&redirect_uri=' + encodeURIComponent(this.securityConfig.login_redirect_url)
            + '&state=' + encodeURIComponent(getBase64EncodeUrlSafe(state));
    };
    /**
     * @private
     * @return {?}
     */
    AuthenticationService.prototype.mathFloorRandom = /**
     * @private
     * @return {?}
     */
    function () {
        return Math.floor((1 + Math.random()) * 0x10000)
            .toString(16)
            .substring(1);
    };
    /**
     * @private
     * @return {?}
     */
    AuthenticationService.prototype.generateNonce = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var nonce = '';
        for (var i = 0; i < 8; i++) {
            nonce += this.mathFloorRandom();
        }
        return nonce;
    };
    /**
     * @private
     * @param {?} url
     * @return {?}
     */
    AuthenticationService.prototype.extractTokenFromUrl = /**
     * @private
     * @param {?} url
     * @return {?}
     */
    function (url) {
        /** @type {?} */
        var hashPart = this.extractHashPart(url);
        /** @type {?} */
        var hashParams = this.extractParameters(decodeURIComponent(hashPart));
        if (hashParams && hashParams.state && hashParams.id_token) {
            return {
                state: hashParams.state,
                token: hashParams.id_token,
                app: this.securityConfig.app_name,
            };
        }
        return null;
    };
    /**
     * @private
     * @param {?} url
     * @return {?}
     */
    AuthenticationService.prototype.extractHashPart = /**
     * @private
     * @param {?} url
     * @return {?}
     */
    function (url) {
        /** @type {?} */
        var hashPosition = url.indexOf('#');
        if (hashPosition >= 0 && url.length > hashPosition) {
            return url.slice(hashPosition + 1);
        }
        else {
            return '';
        }
    };
    /**
     * @private
     * @param {?} paramString
     * @return {?}
     */
    AuthenticationService.prototype.extractParameters = /**
     * @private
     * @param {?} paramString
     * @return {?}
     */
    function (paramString) {
        return paramString.split('&')
            .reduce((/**
         * @param {?} params
         * @param {?} keyValueText
         * @return {?}
         */
        function (params, keyValueText) {
            if (keyValueText) {
                /** @type {?} */
                var keyValue = keyValueText.split('=');
                if (keyValue.length === 2) {
                    /** @type {?} */
                    var key = keyValue[0];
                    /** @type {?} */
                    var value = keyValue[1];
                    /** @type {?} */
                    var decodedValue = key === 'state' ? getBase64DecodeUrlSafe(value) : value;
                    params[key] = decodeURIComponent(decodedValue);
                }
            }
            return params;
        }), {});
    };
    /**
     * @private
     * @param {?} token
     * @return {?}
     */
    AuthenticationService.prototype.buildIdpLogoutUrl = /**
     * @private
     * @param {?} token
     * @return {?}
     */
    function (token) {
        return this.securityConfig.idp_base_url + 'logout'
            + '?id_token=' + token
            + '&post_logout_redirect_uri=' + encodeURIComponent(this.securityConfig.logout_redirect_url);
    };
    AuthenticationService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    AuthenticationService.ctorParameters = function () { return [
        { type: LoginService },
        { type: Router },
        { type: RedirectorService },
        { type: undefined, decorators: [{ type: Inject, args: [SECURITY_CONFIG,] }] }
    ]; };
    return AuthenticationService;
}());
export { AuthenticationService };
if (false) {
    /**
     * @type {?}
     * @protected
     */
    AuthenticationService.prototype.securityConfig;
    /** @type {?} */
    AuthenticationService.prototype.isLoggedIn;
    /**
     * @type {?}
     * @protected
     */
    AuthenticationService.prototype._token;
    /** @type {?} */
    AuthenticationService.prototype.loginEvents;
    /**
     * @type {?}
     * @private
     */
    AuthenticationService.prototype.loginService;
    /**
     * @type {?}
     * @private
     */
    AuthenticationService.prototype.router;
    /**
     * @type {?}
     * @private
     */
    AuthenticationService.prototype.redirectorService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aGVudGljYXRpb24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmeC1saWIvY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImxpYi9meC1zZWN1cml0eS9zZXJ2aWNlcy9hdXRoZW50aWNhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUNsRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUE7QUFDeEMsT0FBTyxFQUFFLGVBQWUsRUFBYyxNQUFNLE1BQU0sQ0FBQTtBQUNsRCxPQUFPLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBQ3pDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG1DQUFtQyxDQUFBO0FBRWxHLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQTtBQUUzRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUE7QUFDOUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUE7Ozs7QUFFeEQseUJBRUM7O0FBR0QsTUFBTSxLQUFPLFNBQVMsR0FBRyxXQUFXOztBQUNwQyxNQUFNLEtBQU8sWUFBWSxHQUFHLGNBQWM7Ozs7QUFFMUMsc0NBSUM7OztJQUhDLGlDQUFhOztJQUNiLGlDQUFhOztJQUNiLCtCQUFXOztBQUdiO0lBa0JFLCtCQUFvQixZQUEwQixFQUMxQixNQUFjLEVBQ2QsaUJBQW9DLEVBQ25CLGNBQThCO1FBSC9DLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQzFCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBZmpELGVBQVUsR0FBRyxLQUFLLENBQUE7UUFpQnZCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxlQUFlLENBQWEsV0FB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S0FBSztvQkFDNUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLGtCQUFrQixDQUFDLFlBQVksQ0FBQyxDQUFBO2lCQUMvQzthQUNGO1lBQ0QsT0FBTyxNQUFNLENBQUE7UUFDZixDQUFDLEdBQUUsRUFBRSxDQUFDLENBQUE7SUFDVixDQUFDOzs7Ozs7SUFFTyxpREFBaUI7Ozs7O0lBQXpCLFVBQTBCLEtBQWE7UUFDckMsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLFlBQVksR0FBRyxRQUFRO2NBQzlDLFlBQVksR0FBRyxLQUFLO2NBQ3BCLDRCQUE0QixHQUFHLGtCQUFrQixDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsQ0FBQTtJQUNoRyxDQUFDOztnQkF4TEYsVUFBVTs7OztnQkFqQkYsWUFBWTtnQkFQWixNQUFNO2dCQVFOLGlCQUFpQjtnREFxQ1gsTUFBTSxTQUFDLGVBQWU7O0lBb0tyQyw0QkFBQztDQUFBLEFBekxELElBeUxDO1NBeExZLHFCQUFxQjs7Ozs7O0lBRWhDLCtDQUF3Qzs7SUFFeEMsMkNBQXlCOzs7OztJQUV6Qix1Q0FBeUI7O0lBU3pCLDRDQUErQzs7Ozs7SUFFbkMsNkNBQWtDOzs7OztJQUNsQyx1Q0FBc0I7Ozs7O0lBQ3RCLGtEQUE0QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnXHJcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcidcclxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcydcclxuaW1wb3J0IHsgbWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycydcclxuaW1wb3J0IHsgZ2V0QmFzZTY0RGVjb2RlVXJsU2FmZSwgZ2V0QmFzZTY0RW5jb2RlVXJsU2FmZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9oZWxwZXIvYmFzZTY0LmhlbHBlcidcclxuaW1wb3J0IHsgUGF5bG9hZCB9IGZyb20gJy4uL2RvbWFpbi9wYXlsb2FkJ1xyXG5pbXBvcnQgeyBTRUNVUklUWV9DT05GSUcgfSBmcm9tICcuLi9kb21haW4vc2VjdXJpdHktY29uZmlnJ1xyXG5pbXBvcnQgeyBTZWN1cml0eUNvbmZpZyB9IGZyb20gJy4uL2Z4LXNlY3VyaXR5Lm1vZHVsZSdcclxuaW1wb3J0IHsgTG9naW5TZXJ2aWNlIH0gZnJvbSAnLi9sb2dpbi5zZXJ2aWNlJ1xyXG5pbXBvcnQgeyBSZWRpcmVjdG9yU2VydmljZSB9IGZyb20gJy4vcmVkaXJlY3Rvci5zZXJ2aWNlJ1xyXG5cclxuaW50ZXJmYWNlIEhhc2hQYXJhbXMge1xyXG4gIFtrZXk6IHN0cmluZ106IHN0cmluZ1xyXG59XHJcblxyXG5leHBvcnQgdHlwZSBMb2dpbkV2ZW50ID0gJ2xvZ2dlZGluJyB8ICdsb2dnZWRvdXQnXHJcbmV4cG9ydCBjb25zdCBUT0tFTl9LRVkgPSAnVVJTX1RPS0VOJ1xyXG5leHBvcnQgY29uc3QgSURfVE9LRU5fS0VZID0gJ1VSU19JRF9UT0tFTidcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSWRwSWRlbnRpdHlUb2tlbiB7XHJcbiAgdG9rZW46IHN0cmluZ1xyXG4gIHN0YXRlOiBzdHJpbmdcclxuICBhcHA6IHN0cmluZ1xyXG59XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBBdXRoZW50aWNhdGlvblNlcnZpY2Uge1xyXG5cclxuICBwcm90ZWN0ZWQgc2VjdXJpdHlDb25maWc6IFNlY3VyaXR5Q29uZmlnXHJcblxyXG4gIHB1YmxpYyBpc0xvZ2dlZEluID0gZmFsc2VcclxuXHJcbiAgcHJvdGVjdGVkIF90b2tlbj86IHN0cmluZ1xyXG4gIGdldCB0b2tlbigpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuX3Rva2VuIHx8ICcnXHJcbiAgfVxyXG5cclxuICBzZXQgdG9rZW4odG9rZW46IHN0cmluZykge1xyXG4gICAgdGhpcy5fdG9rZW4gPSB0b2tlblxyXG4gIH1cclxuXHJcbiAgcHVibGljIGxvZ2luRXZlbnRzOiBCZWhhdmlvclN1YmplY3Q8TG9naW5FdmVudD5cclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBsb2dpblNlcnZpY2U6IExvZ2luU2VydmljZSxcclxuICAgICAgICAgICAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxyXG4gICAgICAgICAgICAgIHByaXZhdGUgcmVkaXJlY3RvclNlcnZpY2U6IFJlZGlyZWN0b3JTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgIEBJbmplY3QoU0VDVVJJVFlfQ09ORklHKSBzZWN1cml0eUNvbmZpZzogU2VjdXJpdHlDb25maWcpIHtcclxuICAgIHRoaXMubG9naW5FdmVudHMgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PExvZ2luRXZlbnQ+KCdsb2dnZWRvdXQnKVxyXG4gICAgdGhpcy5pbml0VG9rZW5Gcm9tU3RvcmFnZSgpXHJcbiAgICB0aGlzLnNlY3VyaXR5Q29uZmlnID0gc2VjdXJpdHlDb25maWdcclxuICB9XHJcblxyXG4gIHB1YmxpYyBsb2dpbihpZGVudGl0eVRva2VuOiBJZHBJZGVudGl0eVRva2VuKTogT2JzZXJ2YWJsZTxJZHBJZGVudGl0eVRva2VuPiB7XHJcbiAgICByZXR1cm4gdGhpcy5sb2dpblNlcnZpY2UubG9naW4oaWRlbnRpdHlUb2tlbilcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgdGFwKCh0b2tlbjogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmluaXRMb2dpbih0b2tlbiwgaWRlbnRpdHlUb2tlbilcclxuICAgICAgICAgIHRoaXMubG9naW5FdmVudHMubmV4dCgnbG9nZ2VkaW4nKVxyXG4gICAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlTG9naW5JbmZvcm1hdGlvbigpXHJcbiAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZUJ5VXJsKCcvbG9naW4tZXJyb3InKVxyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIG1hcCgoKSA9PlxyXG4gICAgICAgICAgaWRlbnRpdHlUb2tlbixcclxuICAgICAgICApLFxyXG4gICAgICApXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbG9nb3V0KCk6IHZvaWQge1xyXG4gICAgLy8gQ2hlY2sgZm9yIElEIHRva2VuXHJcbiAgICBjb25zdCBpZFRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oSURfVE9LRU5fS0VZKVxyXG4gICAgdGhpcy5yZW1vdmVMb2dpbkluZm9ybWF0aW9uKClcclxuICAgIGlmIChpZFRva2VuKSB7XHJcbiAgICAgIHRoaXMucmVkaXJlY3RvclNlcnZpY2UucmVkaXJlY3RUb1VybCh0aGlzLmJ1aWxkSWRwTG9nb3V0VXJsKGlkVG9rZW4pKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybCgnLycpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0QXV0aFRva2VuSGVhZGVyU3RyaW5nKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gJ0JlYXJlciAnICsgdGhpcy50b2tlblxyXG4gIH1cclxuXHJcbiAgcHVibGljIGluaXRUb2tlbkZyb21TdG9yYWdlKCk6IHZvaWQge1xyXG4gICAgY29uc3Qgc3RvcmVkVG9rZW46IHN0cmluZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFRPS0VOX0tFWSlcclxuICAgIGlmIChzdG9yZWRUb2tlbiA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcGFydHM6IHN0cmluZ1tdID0gc3RvcmVkVG9rZW4uc3BsaXQoJy4nKVxyXG4gICAgICBjb25zdCBwYXlsb2FkID0gSlNPTi5wYXJzZShhdG9iKHBhcnRzWzFdKSlcclxuICAgICAgY29uc3QgdW50aWwgPSBuZXcgRGF0ZShwYXlsb2FkLmV4cCAqIDEwMDApXHJcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcclxuXHJcbiAgICAgIGlmIChub3cgPCB1bnRpbCkge1xyXG4gICAgICAgIHRoaXMudG9rZW4gPSBzdG9yZWRUb2tlblxyXG4gICAgICAgIHRoaXMuaXNMb2dnZWRJbiA9IHRydWVcclxuICAgICAgICB0aGlzLmxvZ2luRXZlbnRzLm5leHQoJ2xvZ2dlZGluJylcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgdGhpcy5yZW1vdmVMb2dpbkluZm9ybWF0aW9uKClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBsb2dpbkZyb21VcmxUb2tlbih1cmw6IHN0cmluZyk6IE9ic2VydmFibGU8SWRwSWRlbnRpdHlUb2tlbj4ge1xyXG4gICAgY29uc3QgaWRlbnRpdHlUb2tlbjogSWRwSWRlbnRpdHlUb2tlbiA9IHRoaXMuZXh0cmFjdFRva2VuRnJvbVVybCh1cmwpXHJcbiAgICByZXR1cm4gdGhpcy5sb2dpbihpZGVudGl0eVRva2VuKVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFBheWxvYWQoKTogUGF5bG9hZCB7XHJcbiAgICBpZiAodGhpcy5pc0xvZ2dlZEluKSB7XHJcbiAgICAgIGNvbnN0IHRva2VuID0gdGhpcy50b2tlblxyXG4gICAgICBjb25zdCBwYXJ0czogc3RyaW5nW10gPSB0b2tlbi5zcGxpdCgnLicpXHJcbiAgICAgIGlmIChwYXJ0cy5sZW5ndGggPj0gMikge1xyXG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGF0b2IocGFydHNbMV0pKVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge3JvbGVzOiBbXSwgdXNlcm5hbWU6ICcnfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGxvZ2luV2l0aFJlZGlyZWN0VXJsKCk6IHZvaWQge1xyXG4gICAgdGhpcy5yZWRpcmVjdFRvSWRwTG9naW4odGhpcy5zZWN1cml0eUNvbmZpZy5sb2dpbl9yZWRpcmVjdF91cmwpXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVkaXJlY3RUb0lkcExvZ2luKHRhcmdldFVybDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLnJlZGlyZWN0b3JTZXJ2aWNlLnJlZGlyZWN0VG9VcmwodGhpcy5idWlsZElkcExvZ2luVXJsKHRhcmdldFVybCkpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluaXRMb2dpbih0b2tlbjogc3RyaW5nLCBpZGVudGl0eVRva2VuOiBJZHBJZGVudGl0eVRva2VuKTogdm9pZCB7XHJcbiAgICB0aGlzLnRva2VuID0gdG9rZW5cclxuICAgIHRoaXMuaXNMb2dnZWRJbiA9IHRydWVcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFRPS0VOX0tFWSwgdG9rZW4pXHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShJRF9UT0tFTl9LRVksIGlkZW50aXR5VG9rZW4udG9rZW4pXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbW92ZUxvZ2luSW5mb3JtYXRpb24oKTogdm9pZCB7XHJcbiAgICB0aGlzLnRva2VuID0gdW5kZWZpbmVkXHJcbiAgICB0aGlzLmlzTG9nZ2VkSW4gPSBmYWxzZVxyXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oVE9LRU5fS0VZKVxyXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oSURfVE9LRU5fS0VZKVxyXG4gICAgdGhpcy5sb2dpbkV2ZW50cy5uZXh0KCdsb2dnZWRvdXQnKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBidWlsZElkcExvZ2luVXJsKHN0YXRlOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuc2VjdXJpdHlDb25maWcuaWRwX2Jhc2VfdXJsICsgJ2F1dGgnXHJcbiAgICAgICsgJz9yZXNwb25zZV90eXBlPWlkX3Rva2VuJ1xyXG4gICAgICArICcmc2NvcGU9b3BlbmlkJ1xyXG4gICAgICArICcmbm9uY2U9JyArIHRoaXMuZ2VuZXJhdGVOb25jZSgpXHJcbiAgICAgICsgJyZjbGllbnRfaWQ9JyArIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLnNlY3VyaXR5Q29uZmlnLmNsaWVudF9pZClcclxuICAgICAgKyAnJnJlZGlyZWN0X3VyaT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuc2VjdXJpdHlDb25maWcubG9naW5fcmVkaXJlY3RfdXJsKVxyXG4gICAgICArICcmc3RhdGU9JyArIGVuY29kZVVSSUNvbXBvbmVudChnZXRCYXNlNjRFbmNvZGVVcmxTYWZlKHN0YXRlKSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgbWF0aEZsb29yUmFuZG9tKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gTWF0aC5mbG9vcigoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMClcclxuICAgICAgLnRvU3RyaW5nKDE2KVxyXG4gICAgICAuc3Vic3RyaW5nKDEpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdlbmVyYXRlTm9uY2UoKTogc3RyaW5nIHtcclxuICAgIGxldCBub25jZSA9ICcnXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykge1xyXG4gICAgICBub25jZSArPSB0aGlzLm1hdGhGbG9vclJhbmRvbSgpXHJcbiAgICB9XHJcbiAgICByZXR1cm4gbm9uY2VcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZXh0cmFjdFRva2VuRnJvbVVybCh1cmw6IHN0cmluZyk6IElkcElkZW50aXR5VG9rZW4ge1xyXG4gICAgY29uc3QgaGFzaFBhcnQgPSB0aGlzLmV4dHJhY3RIYXNoUGFydCh1cmwpXHJcbiAgICBjb25zdCBoYXNoUGFyYW1zOiBIYXNoUGFyYW1zID0gdGhpcy5leHRyYWN0UGFyYW1ldGVycyhkZWNvZGVVUklDb21wb25lbnQoaGFzaFBhcnQpKVxyXG4gICAgaWYgKGhhc2hQYXJhbXMgJiYgaGFzaFBhcmFtcy5zdGF0ZSAmJiBoYXNoUGFyYW1zLmlkX3Rva2VuKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3RhdGU6IGhhc2hQYXJhbXMuc3RhdGUsXHJcbiAgICAgICAgdG9rZW46IGhhc2hQYXJhbXMuaWRfdG9rZW4sXHJcbiAgICAgICAgYXBwOiB0aGlzLnNlY3VyaXR5Q29uZmlnLmFwcF9uYW1lLFxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBleHRyYWN0SGFzaFBhcnQodXJsOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgaGFzaFBvc2l0aW9uID0gdXJsLmluZGV4T2YoJyMnKVxyXG4gICAgaWYgKGhhc2hQb3NpdGlvbiA+PSAwICYmIHVybC5sZW5ndGggPiBoYXNoUG9zaXRpb24pIHtcclxuICAgICAgcmV0dXJuIHVybC5zbGljZShoYXNoUG9zaXRpb24gKyAxKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuICcnXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGV4dHJhY3RQYXJhbWV0ZXJzKHBhcmFtU3RyaW5nOiBzdHJpbmcpOiBIYXNoUGFyYW1zIHtcclxuICAgIHJldHVybiBwYXJhbVN0cmluZy5zcGxpdCgnJicpXHJcbiAgICAgIC5yZWR1Y2UoKHBhcmFtczogSGFzaFBhcmFtcywga2V5VmFsdWVUZXh0OiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAoa2V5VmFsdWVUZXh0KSB7XHJcbiAgICAgICAgICBjb25zdCBrZXlWYWx1ZSA9IGtleVZhbHVlVGV4dC5zcGxpdCgnPScpXHJcbiAgICAgICAgICBpZiAoa2V5VmFsdWUubGVuZ3RoID09PSAyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IGtleVZhbHVlWzBdXHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0ga2V5VmFsdWVbMV1cclxuICAgICAgICAgICAgY29uc3QgZGVjb2RlZFZhbHVlID0ga2V5ID09PSAnc3RhdGUnID8gZ2V0QmFzZTY0RGVjb2RlVXJsU2FmZSh2YWx1ZSkgOiB2YWx1ZVxyXG4gICAgICAgICAgICBwYXJhbXNba2V5XSA9IGRlY29kZVVSSUNvbXBvbmVudChkZWNvZGVkVmFsdWUpXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwYXJhbXNcclxuICAgICAgfSwge30pXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGJ1aWxkSWRwTG9nb3V0VXJsKHRva2VuOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuc2VjdXJpdHlDb25maWcuaWRwX2Jhc2VfdXJsICsgJ2xvZ291dCdcclxuICAgICAgKyAnP2lkX3Rva2VuPScgKyB0b2tlblxyXG4gICAgICArICcmcG9zdF9sb2dvdXRfcmVkaXJlY3RfdXJpPScgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5zZWN1cml0eUNvbmZpZy5sb2dvdXRfcmVkaXJlY3RfdXJsKVxyXG4gIH1cclxufVxyXG4iXX0=